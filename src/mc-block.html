<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-material/paper-material.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">

<link rel="import" href="./mc-icon.html">
<dom-module id="mc-block">

  <template>

    <style>
      :host {
        display: inline-table;
        cursor: default;
        margin: 0px;
        border: 1px solid white;
      }

      #block {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 30px;
        height: 30px;
        overflow: hidden;
      }

      /*@media (max-width: 640px) {
        #block {
          display: flex;
          align-items: center;
          justify-content: center;
          width: 20px;
          height: 20px;
          overflow: hidden;
        }
      }*/

      /*#mark {
        display: flex;
        justify-content: center;
        align-items: center;
        width: 30px;
        height: 30px;
        position: absolute;
        z-index: 1;
      }*/

      .unknow {
        background-color: gray;
      }

      .know {
        background-color: #e4e4e4;
        color: black;
      }

      .mark {
        background-color: #ffa96c;
      }
    </style>


    <!-- <div id="block"> -->
    <div id="block" class$="[[blockClass]]">

      <template is="dom-if" if="[[isMark]]">
        <div id="mark">
          <iron-icon icon="grade"></iron-icon>
        </div>
      </template>

      <template is="dom-if" if="[[isOpen]]">

        <template is="dom-if" if="[[isMine]]">
          <iron-icon icon="error"></iron-icon>
        </template>

        <template is="dom-if" if="[[!isMine]]">
          {{mine}}
        </template>

      </template>

    </div>

  </template>

  <script>

    Polymer({

      is: 'mc-block',

      properties: {
        mineObject: {
          type: Object,
          notify: true
        },

        mine: {
          type: String,
          notify: true,
          computed: '_computeMine(mineNumber)'
        },

        mineNumber: {
          type: Number,
          notify: true,
          computed: '_computeMineNumber(mineObject)'
        },

        blockXy: {
          type: Object,
          notify: true,
          computed: '_computeBlockXy(mineObject)'
        },

        isMine: {
          type: Boolean,
          notify: true,
          computed: '_computeIsMine(mineNumber)'
        },

        isOpen: {
          type: Boolean,
          notify: true,
          value: false
        },

        isMark: {
          type: Boolean,
          notify: true,
          computed: '_computeIsMark(markStatus)'
        },

        markStatus: {
          type: Number,
          notify: true,
          value: 0
        },

        blockClass: {
          type: String,
          notify: true,
          computed: '_computeBlockClass(isOpen, isMark)'
        }
      },

      // 屏蔽鼠标右键弹出菜单
      ready: function() {
        this.oncontextmenu = function() {
          return false;
        }
      },

      _computeMine: function(mineNumber) {
        if (mineNumber === 0) {
          return '';
        }

        return mineNumber;
      },

      _computeIsMine: function(mineNumber) {
        return mineNumber === -1;
      },

      _computeMineNumber: function(mineObject) {
        return mineObject.mineNumber;
      },

      _computeBlockXy: function(mineObject) {
        return mineObject.blockCoordinate;
      },

      _computeIsMark: function(markStatus) {
        if (markStatus === 0) {
          return false;
        }

        if (markStatus === 1) {
          return true;
        }

        this.markStatus = 0;
        return false;
      },

      _computeBlockClass: function(isOpen, isMark) {
        if (isOpen) {
          if (this.mineNumber === 0) {
            this.fire('cleanaround', this.blockXy, {bubble: false});
          }
          return 'know';
        }

        if (isMark) {
          return 'mark';
        }

        return 'unknow';
      }

    });

  </script>

</dom-module>
